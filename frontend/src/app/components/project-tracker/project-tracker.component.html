<div class="fade-in">
  <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
      <h1 style="margin: 0;">Welcome, Joao</h1>
      <p style="color: #888; margin: 5px 0 0 0;">Systems Overview</p>
    </div>
    <button class="refresh-btn" (click)="onRefresh()">üîÑ Refresh Dashboard</button>
  </header>

  <div class="home-grid">
    
    <section class="card">
      <h3 style="margin-bottom: 15px; color: #007bff;">Server Connection</h3>
      <div class="status-wrapper" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
        <span class="dot" [class.online]="serverMessage.includes('Connected')"></span>
        <p style="margin: 0;">{{ serverMessage }}</p>
      </div>
      <button class="primary-btn" style="width: 100%;" (click)="onCheckServer()">Ping Server</button>
    </section>

    <section class="card">
      <h3 style="margin-bottom: 15px; color: #007bff;">Registered Residents</h3>
      <table>
        <thead>
          <tr>
            <th>Username</th>
            <th>Role</th>
            <th style="text-align: right;">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (user of allUsers; track user._id) {
            <tr>
              <td>{{ user.username }}</td>
              <td><span class="badge" style="background: #333; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;">{{ user.role }}</span></td>
              <td style="text-align: right; color: #28a745; font-size: 0.9rem;">‚óè Active</td>
            </tr>
          }
        </tbody>
      </table>
    </section>

    <section class="card full-width">
  <div class="tracker-tabs" style="display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">
    <h2 (click)="setTrackerMode('projects')" [style.color]="trackerMode === 'projects' ? '#007bff' : '#666'" style="cursor: pointer; margin: 0;">üöÄ Projects</h2>
    <h2 (click)="setTrackerMode('tasks')" [style.color]="trackerMode === 'tasks' ? '#007bff' : '#666'" style="cursor: pointer; margin: 0;">‚úÖ Tasks</h2>
  </div>

  @if (trackerMode === 'projects') {
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <p style="color: #888;">Manage your high-level project goals.</p>
      @if (userRole === 'Admin') {
        <div class="add-project-form">
          <input type="text" #pTitle placeholder="Project Title">
          <input type="text" #pDesc placeholder="Description">
          <button class="primary-btn" (click)="onAddProject(pTitle.value, pDesc.value); pTitle.value=''; pDesc.value=''">+ Add</button>
        </div>
      }
    </div>
    }

  @if (trackerMode === 'tasks') {
    <div class="add-task-global" style="margin-bottom: 20px; display: flex; gap: 10px;">
      <input type="text" #globalTaskInput placeholder="What needs to be done?" style="flex: 1; padding: 10px; background: #1a1a1a; color: white; border: 1px solid #333; border-radius: 4px;">
      <button class="primary-btn" (click)="onAddGlobalTask(globalTaskInput.value); globalTaskInput.value=''">Add Task</button>
    </div>

    <ul class="task-list" style="list-style: none; padding: 0;">
  @for (task of allTasks; track task._id) {
    <li style="display: flex; align-items: center; justify-content: space-between; background: #2a2a2a; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #007bff;">
      <div style="display: flex; align-items: center; gap: 15px;">
        <input type="checkbox" [checked]="task.completed" (change)="onToggleTask(task)" style="width: 20px; height: 20px; cursor: pointer;">
        <span [style.textDecoration]="task.completed ? 'line-through' : 'none'" [style.color]="task.completed ? '#666' : '#fff'">
          {{ task.text }}
        </span>
      </div>
      <button class="delete-btn" (click)="onDeleteTask(task)" style="background: transparent; color: #ff4444; border: none; cursor: pointer; font-size: 1.2rem;">√ó</button>
    </li>
  }
</ul>
  }
</section>
  </div>
</div>

@if (selectedProject) {
  <div class="project-detail-overlay">
    <div class="project-detail-card">
      <button class="close-btn" (click)="selectedProject = null">√ó</button>
      <h2 style="color: #007bff;">{{ selectedProject.title }}</h2>
      <p style="color: #ccc;">{{ selectedProject.description }}</p>
      <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
      
      <h3>Tasks</h3>
      <ul class="task-list" style="list-style: none; padding: 0;">
        @for (task of selectedProject.tasks; track $index) {
          <li style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; background: #2a2a2a; padding: 10px; border-radius: 6px;">
            <input type="checkbox" [checked]="task.completed" style="width: auto; margin: 0;"> 
            <span>{{ task.text }}</span>
          </li>
        } @empty {
          <li style="color: #666; font-style: italic;">No tasks added yet.</li>
        }
      </ul>

      <div class="add-task" style="display: flex; gap: 10px; margin-top: 20px;">
        <input type="text" #taskInput placeholder="New task..." style="flex: 1;">
        <button class="primary-btn" (click)="onAddTask(selectedProject._id, taskInput.value); taskInput.value=''">Add</button>
      </div>
    </div>
  </div>
}