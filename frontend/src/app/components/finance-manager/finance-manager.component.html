<div class="finance-container fade-in">
  <header>
    <h1>üè¶ Personal Finance</h1>
    <div class="sub-nav">
      <button [class.active-tab]="incomeSubView === 'expenses'" (click)="incomeSubView = 'expenses'">Expenses</button>
      <button [class.active-tab]="incomeSubView === 'income'" (click)="incomeSubView = 'income'">Income / Cash Flow</button>
    </div>
    <p class="subtitle">Manage and track your bank transactions</p>
  </header>

  <div class="stats-grid">
    <div class="card stat-box">
      <label>Total Income</label>
      <p class="stat-value" style="color: #28a745;">+${{ totalIncome | number:'1.2-2' }}</p>
    </div>
    <div class="card stat-box">
      <label>Total Expenses</label>
      <p class="stat-value" style="color: #ff4444;">-${{ totalExpenses | number:'1.2-2' }}</p>
    </div>
    <div class="card stat-box">
      <label>Net Cash Flow</label>
      <p class="stat-value" [style.color]="totalNetBalance >= 0 ? '#fff' : '#ff4444'">
        ${{ totalNetBalance | number:'1.2-2' }}
      </p>
    </div>
    <div class="card stat-box">
      <label>Capital One</label>
      <p class="stat-value" style="color: #007bff; font-size: 1.1rem;">${{ capitalOneBalance | number:'1.2-2' }}</p>
    </div>
    <div class="card stat-box">
      <label>Santander</label>
      <p class="stat-value" style="color: #ec0000; font-size: 1.1rem;">${{ santanderBalance | number:'1.2-2' }}</p>
    </div>
  </div>

  <app-financial-goals 
    [goals]="goals" 
    (addGoal)="onAddGoal($event)"
    (updateGoal)="onUpdateGoal($event)"
    (deleteGoal)="onDeleteGoal($event)">
  </app-financial-goals>

  @if (incomeSubView === 'expenses') {
    <div class="fade-in">
      <section class="card finance-form-card">
        <h3>Log New Transaction</h3>
        <div class="finance-form-grid">
          <div class="form-group"><label>Date</label><input type="date" #fDate [value]="today"></div>
          <div class="form-group">
            <label>Bank</label>
            <select #fBank>
              <option value="Capital One">Capital One</option>
              <option value="Santander">Santander</option>
            </select>
          </div>
          <div class="form-group"><label>Amount</label><input type="number" #fAmount placeholder="0.00" step="0.01"></div>
          <div class="form-group">
            <label>Category</label>
            <select #fCategory>
              <option value="Dining">Dining</option>
              <option value="Merchandise">Merchandise</option>
              <option value="Gas/Automotive">Gas/Automotive</option>
              <option value="Bill">Bill</option>
            </select>
          </div>
          <div class="form-group full-width"><label>Description</label><input type="text" #fDesc placeholder="Weekly Groceries"></div>
        </div>
        <button class="primary-btn submit-finance" (click)="onAddExpense({date: fDate.value, bank: fBank.value, amount: fAmount.value, category: fCategory.value, description: fDesc.value})">Add Transaction</button>
      </section>

      <section class="card finance-history-card">
        <h3>Recent Transactions</h3>
        <table>
          <thead>
    <tr>
        <th>Date</th>
        <th>Source</th>
        <th>Note</th>
        <th style="text-align: right;">Amount</th> <th style="text-align: center;">Action</th>
    </tr>
</thead>
          <tbody>
            @for (item of allFinance; track item._id) {
              <tr>
                <td>{{ item.date }}</td>
                <td><span class="badge" [style.background]="item.bank === 'Capital One' ? '#003a70' : '#ec0000'">{{ item.bank }}</span></td>
                <td>{{ item.category }}</td>
                <td style="color: #aaa;">{{ item.description }}</td>
                <td style="text-align: right; font-weight: bold;">${{ item.amount | number:'1.2-2' }}</td>
                <td style="text-align: center;"><button class="row-delete-btn" (click)="onDeleteExpense(item._id)">üóëÔ∏è</button></td>
              </tr>
            }
          </tbody>
        </table>
      </section>
    </div>
  }

  @if (incomeSubView === 'income') {
    <div class="fade-in">
      <section class="card finance-form-card">
        <h3>Log Income / Cash Flow</h3>
        <div class="finance-form-grid">
          <div class="form-group"><label>Date</label><input type="date" #iDate [value]="today"></div>
          <div class="form-group">
            <label>Source</label>
            <select #iSource>
              <option value="Salary">Salary</option>
              <option value="Dividends">Dividends</option>
              <option value="Freelance">Freelance</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group"><label>Amount</label><input type="number" #iAmount placeholder="0.00"></div>
          <div class="form-group full-width"><label>Note</label><input type="text" #iNote placeholder="Monthly Paycheck"></div>
        </div>
        <button class="primary-btn" style="background: #28a745; width: 100%;" 
          (click)="onAddIncome({date: iDate.value, source: iSource.value, amount: iAmount.value, note: iNote.value}); iAmount.value=''; iNote.value=''">
          Log Income
        </button>
      </section>

      <section class="card finance-history-card">
        <h3>Income History</h3>
        <table>
          <thead>
            <tr><th>Date</th><th>Source</th><th>Note</th><th style="text-align: right;">Amount</th><th style="text-align: center;">Action</th></tr>
          </thead>
          <tbody>
            @for (inc of allIncome; track inc._id) {
              <tr>
                <td>{{ inc.date }}</td>
                <td><span class="badge" style="background: #28a745;">{{ inc.source }}</span></td>
                <td style="color: #aaa;">{{ inc.note }}</td>
                <td style="text-align: right; color: #28a745; font-weight: bold;">+${{ inc.amount | number:'1.2-2' }}</td>
                <td style="text-align: center;">
                  <button class="row-delete-btn" (click)="onDeleteIncome(inc._id)">üóëÔ∏è</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </section>
    </div>
  }
</div>